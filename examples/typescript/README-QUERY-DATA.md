# wIndexer Data Query Tool

This enhanced script (`query-all-data.ts`) allows you to query data from both wIndexer API and Solana blockchain directly. It's designed to work with the data generated by the `generate-data.sh` script and includes multiple useful endpoints and an interactive search mode.

## Features

- API health status checking
- Transaction statistics
- Account and transaction queries
- Token account information
- Program account lookup
- Interactive search mode for custom queries
- Real-time Solana account balances
- Detailed transaction history with balance changes
- JSON output options for integration with other tools

## Prerequisites

1. A running Solana validator (started with `make run-validator-with-geyser`)
2. A running wIndexer API (started with `make run-indexer`)
3. Data generated with `generate-data.sh` script

## How to Use

### Step 1: Generate Test Data

First, run the data generation script to create test transactions:

```bash
cd scripts/test-scripts
./generate-data.sh
```

This will create test transactions from the payer account to random recipients.

### Step 2: Query the Data

You can query the data using one of these methods:

#### Using npm Scripts (Recommended)

```bash
# Standard output
npm run query-all-data

# Interactive mode
npm run query-all-data-interactive

# JSON output (for programmatic use)
npm run query-all-data-json

# Pretty JSON output (for debugging)
npm run query-all-data-pretty
```

#### Alternative Method (Using Compiled JavaScript)

```bash
cd examples/typescript
./compile.sh
node dist/query-all-data.js

# With interactive mode
node dist/query-all-data.js --interactive

# With JSON output
node dist/query-all-data.js --json
node dist/query-all-data.js --pretty-json
```

## Output Formats

### Standard Output

By default, the script displays formatted text output, organized by section.

### Interactive Mode

Add the `--interactive` flag to enter interactive mode:

```bash
npm run query-all-data-interactive
```

In interactive mode, you can:
- Search transactions by account address
- Look up transaction details by signature
- Find program accounts by program ID
- And more...

### JSON Output

For programmatic use or integration with other tools, use the JSON output options:

```bash
# Compact JSON
npm run query-all-data-json

# Pretty-printed JSON (indented)
npm run query-all-data-pretty
```

This will output all data as a single JSON object, which can be piped to other tools or saved to a file:

```bash
# Save to a file
npm run query-all-data-json > results.json

# Pipe to jq for filtering
npm run query-all-data-json | jq '.transactions'
```

## API Endpoints Used

The script queries the following API endpoints:

1. `/api/health` - API health status
2. `/api/stats` - Transaction and account statistics
3. `/api/transactions` - List of transactions
4. `/api/accounts` - List of accounts
5. `/api/tokens/{address}` - Token accounts for an address
6. `/api/transactions/byAccount/{address}` - Transactions by account (interactive mode)
7. `/api/transactions/{signature}` - Transaction details by signature (interactive mode)
8. `/api/programs/{programId}/accounts` - Program accounts (interactive mode)

## Implementation Guide

If some endpoints are showing as "not available", check the `api-endpoints-guide.md` file for sample implementations that you can add to your wIndexer API server.

## Troubleshooting

- If certain API endpoints return errors, they might not be implemented in your wIndexer instance yet
- If you don't see any transactions in the API sections, make sure wIndexer is running and has had time to index the data
- If the script can't find the keypair file, it will use a fallback account address
- If interactive mode doesn't work, make sure you're passing the `--interactive` flag 